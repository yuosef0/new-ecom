# ๐ณ Paymob Integration - Quick Start

ุชู ุฅุถุงูุฉ ุชูุงูู Paymob ุจูุฌุงุญ ุฅูู ุงููุดุฑูุน! ูุฐุง ุงูุฏููู ุงูุณุฑูุน ูุณุงุนุฏู ุนูู ุงูุจุฏุก.

## โ ูุง ุชู ุฅุถุงูุชู

- โ ุจูุงูุงุช Paymob Test API ูู `.env.local`
- โ ุชูุงูู ูุงูู ูุน Paymob API
- โ ุฏุนู ุจุทุงูุงุช ุงูุงุฆุชูุงู/ุงูุฎุตู
- โ ุฏุนู ุงููุญุงูุธ ุงูุฅููุชุฑูููุฉ
- โ ุฏุนู ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู (COD)
- โ ูุนุงูุฌุฉ Webhooks
- โ HMAC Verification ููุฃูุงู

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุชุดุบูู ุงููุดุฑูุน

```bash
npm run dev
```

### 2. ุงุฎุชุจุงุฑ ุงูุฏูุน

1. ุงูุชุญ `http://localhost:3000`
2. ุฃุถู ููุชุฌ ุฅูู ุงูุณูุฉ
3. ุงุฐูุจ ุฅูู `/checkout`
4. ุฃุฏุฎู ุจูุงูุงุช ุงูุดุญู
5. ุงุฎุชุฑ **Credit/Debit Card**
6. ุงุณุชุฎุฏู ุจุทุงูุฉ ุงูุงุฎุชุจุงุฑ:
   ```
   Card Number: 4987654321098769
   CVV: 123
   Expiry Date: 12/25
   ```

## ๐ ุงููููุงุช ุงููุงูุฉ

| ุงูููู | ุงููุตู |
|------|-------|
| [`PAYMOB_SETUP.md`](./PAYMOB_SETUP.md) | ุฏููู ุงูุฅุนุฏุงุฏ ุงููุงูู |
| [`PAYMOB_TESTING.md`](./PAYMOB_TESTING.md) | ุฏููู ุงูุงุฎุชุจุงุฑ ูุงูุฃูุซูุฉ |
| [`.env.local`](./.env.local) | ุจูุงูุงุช Test API |

## ๐ ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ุงูุญุงููุฉ

ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูู `.env.local` ูู ุจูุงูุงุช ุงุฎุชุจุงุฑ ุนุงูุฉ ูู Paymob. ููุญุตูู ุนูู ุฃูุถู ุชุฌุฑุจุฉ:

1. ุณุฌู ุญุณุงุจ ูู [Paymob Portal](https://accept.paymob.com/portal2/en/register)
2. ุงุญุตู ุนูู ุจูุงูุงุชู ุงูุฎุงุตุฉ ูู **Settings** โ **Account Info**
3. ุงุณุชุจุฏู ุงูุจูุงูุงุช ูู `.env.local`

## ๐ณ ุจุทุงูุงุช ุงูุงุฎุชุจุงุฑ

### โ ุจุทุงูุงุช ูุงุฌุญุฉ

| ุฑูู ุงูุจุทุงูุฉ | CVV | ุชุงุฑูุฎ ุงูุงูุชูุงุก |
|-------------|-----|----------------|
| `4987654321098769` | `123` | ุฃู ุชุงุฑูุฎ ูุณุชูุจูู |
| `5123456789012346` | `123` | ุฃู ุชุงุฑูุฎ ูุณุชูุจูู |

### โ ุจุทุงูุงุช ูุงุดูุฉ

| ุฑูู ุงูุจุทุงูุฉ | CVV | ุชุงุฑูุฎ ุงูุงูุชูุงุก |
|-------------|-----|----------------|
| `4000000000000002` | `123` | ุฃู ุชุงุฑูุฎ ูุณุชูุจูู |

## ๐ Flow ุงูุฏูุน

```mermaid
graph TD
    A[ุงููุณุชุฎุฏู ูุถูู ููุชุฌุงุช] --> B[ูุฐูุจ ุฅูู Checkout]
    B --> C[ูุฏุฎู ุจูุงูุงุช ุงูุดุญู]
    C --> D{ูุฎุชุงุฑ ุทุฑููุฉ ุงูุฏูุน}
    D -->|ุจุทุงูุฉ| E[ูุชู ุฅูุดุงุก ุงูุทูุจ]
    D -->|COD| F[ูุชู ุฅูุดุงุก ุงูุทูุจ ูุจุงุดุฑุฉ]
    E --> G[Paymob Authentication]
    G --> H[ุฅูุดุงุก Paymob Order]
    H --> I[ุงูุญุตูู ุนูู Payment Token]
    I --> J[ุงูุชุญููู ุฅูู Paymob iFrame]
    J --> K{ุงูุฏูุน}
    K -->|ูุงุฌุญ| L[Webhook: ุชุญุฏูุซ ุงูุทูุจ]
    K -->|ูุงุดู| M[Webhook: ุชุญุฏูุซ ุงูุทูุจ]
    L --> N[ุตูุญุฉ ุงูุชุฃููุฏ]
    M --> O[ุฑุณุงูุฉ ุฎุทุฃ]
    F --> N
```

## ๐๏ธ ุงููููุงุช ุงูุชูููุฉ

### Backend API Routes

- **`/api/checkout`** - ุฅูุดุงุก ุงูุทูุจ ูุชููุฆุฉ ุงูุฏูุน
- **`/api/webhooks/paymob`** - ุงุณุชูุจุงู ุฅุดุนุงุฑุงุช Paymob

### Paymob Library

- **`src/lib/paymob/client.ts`** - ุงูุชูุงูู ูุน Paymob API
- **`src/lib/paymob/webhook.ts`** - ูุนุงูุฌุฉ Webhooks
- **`src/lib/paymob/types.ts`** - TypeScript Types

### Frontend Components

- **`src/app/(storefront)/checkout/page.tsx`** - ุตูุญุฉ ุงูุฏูุน
- **`src/components/storefront/checkout/CheckoutForm.tsx`** - ูููุฐุฌ ุงูุดุญู

## ๐ ุงูุฃูุงู

- โ HMAC Verification ูุฌููุน Webhooks
- โ Server-side validation ูุฌููุน ุงูุจูุงูุงุช
- โ Environment variables ููุจูุงูุงุช ุงูุญุณุงุณุฉ
- โ Idempotency ููู Webhooks

## ๐ ูุฑุงูุจุฉ ุงูุทูุจุงุช

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ุนุฑุถ ุขุฎุฑ ุงูุทูุจุงุช
SELECT 
  order_number,
  status,
  payment_status,
  payment_method,
  total,
  created_at
FROM orders
ORDER BY created_at DESC
LIMIT 10;
```

### ูู Paymob Portal

1. ุงุฐูุจ ุฅูู [Transactions](https://accept.paymob.com/portal2/en/transactions)
2. ุฑุงุฌุน ุฌููุน ุงููุนุงููุงุช
3. ุชุญูู ูู ุงูุชูุงุตูู ูุงูุญุงูุฉ

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "Failed to authenticate with Paymob"

```bash
# ุชุญูู ูู PAYMOB_API_KEY ูู .env.local
cat .env.local | grep PAYMOB_API_KEY
```

### ูุดููุฉ: "Invalid integration ID"

```bash
# ุชุญูู ูู PAYMOB_INTEGRATION_ID ูู .env.local
cat .env.local | grep PAYMOB_INTEGRATION_ID
```

### ูุดููุฉ: "Webhook not received"

1. ุงุณุชุฎุฏู ngrok ููุงุฎุชุจุงุฑ ุงููุญูู
2. ุชุญูู ูู Webhook URL ูู Paymob Portal
3. ุฑุงุฌุน HMAC Secret

## ๐ ุงูุญุตูู ุนูู ุงููุณุงุนุฏุฉ

- ๐ [ุฏููู ุงูุฅุนุฏุงุฏ ุงููุงูู](./PAYMOB_SETUP.md)
- ๐งช [ุฏููู ุงูุงุฎุชุจุงุฑ](./PAYMOB_TESTING.md)
- ๐ [Paymob Documentation](https://docs.paymob.com/)
- ๐ฌ [Paymob Support](https://accept.paymob.com/portal2/en/support)

## ๐ ุงูุงูุชูุงู ููุฅูุชุงุฌ

ุนูุฏ ุงูุงุณุชุนุฏุงุฏ ููุฅุทูุงู:

1. โ ุฃููู KYC ูู Paymob Portal
2. โ ุงุญุตู ุนูู Live API credentials
3. โ ุญุฏุซ `.env.production` ุจุจูุงูุงุช ุงูุฅูุชุงุฌ
4. โ ุญุฏุซ Webhook URL ูู Portal
5. โ ุงุฎุชุจุฑ ุนูู staging environment
6. โ ุฑุงูุจ ุฃูู 10 ูุนุงููุงุช ุจุนูุงูุฉ

---

## ๐ ููุงุญุธุงุช ูุงูุฉ

> **โ๏ธ ุชุญุฐูุฑ:** ุงูุจูุงูุงุช ุงูุญุงููุฉ ูู ุจูุงูุงุช ุงุฎุชุจุงุฑ. ูุง ุชุณุชุฎุฏููุง ูู ุงูุฅูุชุงุฌ!

> **๐ก ูุตูุญุฉ:** ุงุญุชูุธ ุจุจูุงูุงุช ุงูุงุฎุชุจุงุฑ ูุงูุฅูุชุงุฌ ูู ูููุงุช ูููุตูุฉ (`.env.local` ู `.env.production`)

> **๐ ุฃูุงู:** ูุง ุชุดุงุฑู API Keys ุฃู HMAC Secrets ูุน ุฃุญุฏ

---

**ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ! ๐**

ุงูุขู ููููู ุงูุจุฏุก ูู ุงุฎุชุจุงุฑ ุงูุฏูุน. ุฑุงุฌุน [`PAYMOB_TESTING.md`](./PAYMOB_TESTING.md) ููุฒูุฏ ูู ุงูุฃูุซูุฉ.
